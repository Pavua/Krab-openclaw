# PRD.md

Обновлено: 2026-02-16
Продукт: Krab AI Userbot (OpenClaw-first)

## 1. Проблема
Пользователь теряет доверие к ассистенту при:
- потере сообщений в burst-сценариях,
- зависаниях/зацикливании локального стрима,
- неверной атрибуции автора в группах,
- непрозрачной модели/контексте/затратах.

## 2. Цели
- Надёжная обработка пачек сообщений без потерь.
- Ясный контекст (кто автор, что форвард, на что reply).
- Стойкий failover local -> cloud.
- Управляемая policy и прозрачная диагностика.

## 3. Нецели
- Слияние Krab/Ear/Voice в один runtime.
- Удаление guardrails для «безлимитной генерации».

## 4. Сценарии
- Burst 3-10 сообщений в одном чате.
- Анализ нескольких пересланных voice/text сообщений.
- Реакции на ответ Краба как сигнал корректировки.
- Принудительный режим `force_cloud`/`force_local`.

## 5. KPI
- FIFO success rate >= 99% для burst-сценариев.
- Local stream fallback success >= 95% при локальных ошибках.
- Снижение повторных «циклических» ответов >= 80%.
- 100% доступность команд диагностики (`!ctx`, `!policy`).

## 6. Приоритеты
- P0: queue/context/stream guardrails/fallback.
- P1: reaction learning + mood + web ops API.
- P2: deeper OpenClaw integration + iOS companion track.

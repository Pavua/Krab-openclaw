<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Krab Web Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0c1016;
            --card-bg: rgba(255, 255, 255, 0.06);
            --accent: #1fb6ff;
            --text: #ecf2ff;
            --muted: #a7b5cc;
            --ok: #22c55e;
            --warn: #f59e0b;
            --bad: #ef4444;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: 'Outfit', sans-serif;
            background: radial-gradient(circle at 10% 20%, #152336 0%, var(--bg) 42%);
            color: var(--text);
            padding: 24px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            gap: 12px;
            margin-bottom: 18px;
            flex-wrap: wrap;
        }

        h1 {
            margin: 0;
            font-size: 2rem;
            letter-spacing: 0.03em;
        }

        .subtitle {
            margin: 0;
            color: var(--muted);
            font-size: 0.95rem;
        }

        .row {
            display: grid;
            gap: 14px;
            margin-bottom: 14px;
        }

        .row.metrics {
            grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
        }

        .row.wide {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .card {
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 16px;
            padding: 16px;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
        }

        .k {
            margin: 0 0 8px;
            color: var(--muted);
            font-size: 0.86rem;
            letter-spacing: 0.04em;
            text-transform: uppercase;
        }

        .v {
            margin: 0;
            font-size: 1.6rem;
            font-weight: 700;
            line-height: 1.2;
            word-break: break-word;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.82rem;
            border: 1px solid;
            margin-right: 8px;
        }

        .ok {
            color: var(--ok);
            border-color: var(--ok);
            background: rgba(34, 197, 94, 0.15);
        }

        .warn {
            color: var(--warn);
            border-color: var(--warn);
            background: rgba(245, 158, 11, 0.16);
        }

        .bad {
            color: var(--bad);
            border-color: var(--bad);
            background: rgba(239, 68, 68, 0.16);
        }

        .links a {
            display: block;
            color: #9ed5ff;
            text-decoration: none;
            margin-bottom: 8px;
            word-break: break-all;
        }

        .links a:hover {
            color: var(--accent);
            text-decoration: underline;
        }

        .meta {
            color: var(--muted);
            font-size: 0.84rem;
        }

        .refresh {
            border: 1px solid rgba(255, 255, 255, 0.16);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.06);
            color: var(--text);
            padding: 8px 12px;
            cursor: pointer;
        }

        .refresh:hover {
            border-color: var(--accent);
        }

        .field {
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.16);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
            padding: 10px 12px;
            font-family: 'Outfit', sans-serif;
            font-size: 0.95rem;
        }

        .field::placeholder {
            color: var(--muted);
        }

        .row-inline {
            display: grid;
            grid-template-columns: 1fr 160px 150px;
            gap: 10px;
            margin-bottom: 10px;
        }

        .assistant-top {
            grid-template-columns: minmax(120px, 1fr) minmax(120px, 1fr) minmax(120px, 1fr) minmax(220px, 1fr);
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 10px;
        }

        .control-grid .meta {
            display: block;
            margin-bottom: 4px;
        }

        select.field option {
            color: #e5ecff;
            background: #0f1521;
        }

        .assistant-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
        }

        .assistant-output {
            white-space: pre-wrap;
            line-height: 1.45;
            font-size: 0.95rem;
            min-height: 120px;
            max-height: 340px;
            overflow: auto;
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 10px;
            padding: 10px;
            background: rgba(8, 12, 18, 0.5);
        }

        .ops-list {
            margin: 0;
            padding-left: 18px;
            line-height: 1.4;
            color: var(--text);
        }

        .ops-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
        }

        .ops-history {
            margin-top: 10px;
            max-height: 140px;
            overflow: auto;
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 10px;
            padding: 8px;
            background: rgba(8, 12, 18, 0.5);
            font-size: 0.84rem;
            line-height: 1.35;
            color: var(--muted);
        }

        @media (max-width: 700px) {
            body {
                padding: 14px;
            }

            .v {
                font-size: 1.3rem;
            }

            .row-inline {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div>
                <h1>ü¶Ä Krab Web Panel</h1>
                <p class="subtitle">–ï–¥–∏–Ω—ã–π –æ–±–∑–æ—Ä —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã: Krab + OpenClaw + Voice Gateway + Local LM</p>
            </div>
            <button id="refreshBtn" class="refresh">–û–±–Ω–æ–≤–∏—Ç—å</button>
        </header>

        <div class="row metrics">
            <div class="card">
                <p class="k">–°–∏—Å—Ç–µ–º–∞</p>
                <p class="v" id="degradation">‚Äî</p>
            </div>
            <div class="card">
                <p class="k">Black Box</p>
                <p class="v" id="bb_total">‚Äî</p>
            </div>
            <div class="card">
                <p class="k">RAG Docs</p>
                <p class="v" id="rag_total">‚Äî</p>
            </div>
            <div class="card">
                <p class="k">Local Model</p>
                <p class="v" id="local_model">‚Äî</p>
            </div>
        </div>

        <div class="row wide">
            <div class="card">
                <p class="k">–°–µ—Ä–≤–∏—Å—ã</p>
                <div id="checks">‚Äî</div>
                <p class="meta" id="updated_at"></p>
            </div>
            <div class="card links">
                <p class="k">–°—Å—ã–ª–∫–∏</p>
                <div id="links">‚Äî</div>
            </div>
            <div class="card">
                <p class="k">–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å</p>
                <p class="v" id="recommended_model">‚Äî</p>
                <p class="meta" id="recommended_meta"></p>
            </div>
            <div class="card">
                <p class="k">Ops Alerts</p>
                <div id="opsAlerts" class="meta">‚Äî</div>
                <p class="meta" id="opsUsageMeta"></p>
                <div class="ops-actions">
                    <input id="opsAlertCode" class="field" placeholder="alert code (–Ω–∞–ø—Ä–∏–º–µ—Ä cloud_share_high)">
                    <input id="opsAlertNote" class="field" placeholder="note (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)">
                    <button id="opsAckBtn" class="refresh">Ack</button>
                    <button id="opsUnackBtn" class="refresh">Unack</button>
                </div>
                <p class="meta" id="opsActionMeta">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ alert-–∞–º–∏ —á–µ—Ä–µ–∑ Web API</p>
                <div id="opsHistory" class="ops-history">–ò—Å—Ç–æ—Ä–∏—è ops: ‚Äî</div>
            </div>
        </div>

        <div class="row">
            <div class="card">
                <p class="k">Web Assistant (–±–µ–∑ Telegram)</p>
                <div class="control-grid">
                    <div>
                        <span class="meta">–†–µ–∂–∏–º —Ä–æ—É—Ç–∏–Ω–≥–∞</span>
                        <select id="modelModeSelect" class="field">
                            <option value="auto">auto (local-first)</option>
                            <option value="local">local (force_local)</option>
                            <option value="cloud">cloud (force_cloud)</option>
                        </select>
                    </div>
                    <div>
                        <span class="meta">–ë—ã—Å—Ç—Ä—ã–π –ø—Ä–µ—Å–µ—Ç</span>
                        <select id="modelPresetSelect" class="field">
                            <option value="balanced_auto">Balanced Auto</option>
                            <option value="local_focus">Local Focus</option>
                            <option value="cloud_reasoning">Cloud Reasoning</option>
                        </select>
                    </div>
                    <div>
                        <span class="meta">–°–ª–æ—Ç</span>
                        <select id="modelSlotSelect" class="field">
                            <option value="chat">chat</option>
                        </select>
                    </div>
                    <div>
                        <span class="meta">–ú–æ–¥–µ–ª—å –¥–ª—è —Å–ª–æ—Ç–∞</span>
                        <select id="modelChoiceSelect" class="field">
                            <option value="google/gemini-2.5-flash">google/gemini-2.5-flash</option>
                        </select>
                    </div>
                </div>
                <div class="assistant-actions">
                    <button id="modelCatalogReloadBtn" class="refresh">–û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥</button>
                    <button id="modelApplyModeBtn" class="refresh">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º</button>
                    <button id="modelApplyPresetBtn" class="refresh">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–µ—Å–µ—Ç</button>
                    <button id="modelApplySlotBtn" class="refresh">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ª–æ—Ç</button>
                    <span class="meta" id="modelControlMeta">–ö–∞—Ç–∞–ª–æ–≥ –º–æ–¥–µ–ª–µ–π –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</span>
                </div>
                <div class="row-inline assistant-top">
                    <select id="assistantTaskType" class="field">
                        <option value="chat">chat</option>
                        <option value="reasoning">reasoning</option>
                        <option value="coding">coding</option>
                        <option value="security">security</option>
                        <option value="infra">infra</option>
                        <option value="review">review</option>
                        <option value="creative">creative</option>
                        <option value="moderation">moderation</option>
                    </select>
                    <select id="assistantReasoningDepth" class="field">
                        <option value="auto">–†–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ: auto</option>
                        <option value="fast">–†–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ: fast</option>
                        <option value="balanced">–†–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ: balanced</option>
                        <option value="deep">–†–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ: deep</option>
                    </select>
                    <select id="assistantUseRag" class="field">
                        <option value="off">RAG: off</option>
                        <option value="on">RAG: on</option>
                    </select>
                    <input id="assistantApiKey" class="field" placeholder="WEB_API_KEY (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)">
                </div>
                <textarea id="assistantPrompt" class="field" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É –¥–ª—è –ö—Ä–∞–±–∞..."></textarea>
                <div class="control-grid" style="margin-top:10px;">
                    <input id="quickWebQuery" class="field" placeholder="–ó–∞–ø—Ä–æ—Å –¥–ª—è web-search (–Ω–æ–≤–æ—Å—Ç–∏, —Ñ–∞–∫—Ç—ã, —Ä—ã–Ω–∫–∏...)">
                    <input id="quickDeepTopic" class="field" placeholder="–¢–µ–º–∞ –¥–ª—è deep research (–¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑)">
                    <input id="quickSourceUrl" class="field" placeholder="URL –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞ (YouTube/—Å—Ç–∞—Ç—å—è/–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)">
                    <input id="assistantFileInput" class="field" type="file" accept=".txt,.md,.json,.csv,.py,.js,.ts,.tsx,.html,.xml,.yaml,.yml">
                </div>
                <div class="assistant-actions">
                    <button id="quickWebBtn" class="refresh">Web Search</button>
                    <button id="quickDeepBtn" class="refresh">Deep Research</button>
                    <button id="quickUrlBtn" class="refresh">–†–∞–∑–æ–±—Ä–∞—Ç—å URL</button>
                    <button id="assistantAttachBtn" class="refresh">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª</button>
                    <span class="meta" id="quickActionMeta">–ë—ã—Å—Ç—Ä—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: –±–µ–∑ —Ä—É—á–Ω—ã—Ö –∫–æ–º–∞–Ω–¥</span>
                </div>
                <div class="assistant-actions">
                    <button id="assistantPlanBtn" class="refresh">Preflight</button>
                    <button id="assistantRunBtn" class="refresh">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                    <span class="meta" id="assistantMeta">–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—Ä–æ—Å–∞–º</span>
                </div>
                <div id="assistantOutput" class="assistant-output">‚Äî</div>
                <div class="row-inline" style="margin-top:10px;">
                    <input id="feedbackScore" class="field" value="5" placeholder="–û—Ü–µ–Ω–∫–∞ 1-5">
                    <input id="feedbackProfile" class="field" placeholder="profile (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)">
                    <input id="feedbackNote" class="field" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)">
                </div>
                <div class="assistant-actions">
                    <button id="feedbackSendBtn" class="refresh">–û—Ü–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
                    <button id="feedbackStatsBtn" class="refresh">–ü–æ–∫–∞–∑–∞—Ç—å Feedback Stats</button>
                    <span class="meta" id="feedbackMeta">–û—Ü–µ–Ω–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –ø—Ä–æ–≥–æ–Ω—É —Ä–æ—É—Ç–µ—Ä–∞, –µ—Å–ª–∏ profile/model –Ω–µ —É–∫–∞–∑–∞–Ω—ã</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        function badge(ok, label) {
            const cls = ok ? 'ok' : 'warn';
            return `<span class="badge ${cls}">${ok ? 'ON' : 'OFF'} ${label}</span>`;
        }

        function setText(id, value) {
            const node = document.getElementById(id);
            if (node) node.textContent = value;
        }

        async function fetchJson(url) {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            return response.json();
        }

        function readWebApiKey() {
            return (document.getElementById('assistantApiKey').value || '').trim();
        }

        async function postJson(url, body, withKey = true, method = 'POST') {
            const headers = { 'Content-Type': 'application/json' };
            if (withKey) {
                const webApiKey = readWebApiKey();
                if (webApiKey) {
                    headers['X-Krab-Web-Key'] = webApiKey;
                }
            }
            const response = await fetch(url, {
                method,
                headers,
                body: method === 'DELETE' ? undefined : JSON.stringify(body || {})
            });
            const payload = await response.json();
            if (!response.ok) {
                throw new Error(payload?.detail || `HTTP ${response.status}`);
            }
            return payload;
        }

        let modelCatalogState = null;

        function normalizedForceMode(rawMode) {
            const normalized = String(rawMode || '').trim().toLowerCase();
            if (normalized === 'force_local' || normalized === 'local') return 'local';
            if (normalized === 'force_cloud' || normalized === 'cloud') return 'cloud';
            return 'auto';
        }

        function fillSelect(nodeId, options, selectedValue = '') {
            const node = document.getElementById(nodeId);
            if (!node) return;
            const current = String(selectedValue || '');
            const html = options.map((item) => {
                const value = String(item.value ?? '');
                const label = String(item.label ?? value);
                const selected = value === current ? ' selected' : '';
                return `<option value="${value}"${selected}>${label}</option>`;
            }).join('');
            node.innerHTML = html || '<option value="">(–ø—É—Å—Ç–æ)</option>';
        }

        function getModelOptionsFromCatalog(catalog) {
            const result = [];
            const localModels = Array.isArray(catalog?.local_models) ? catalog.local_models : [];
            const cloudPresets = Array.isArray(catalog?.cloud_presets) ? catalog.cloud_presets : [];
            const cloudSlots = catalog?.cloud_slots || {};

            for (const item of localModels) {
                const modelId = String(item?.id || '').trim();
                if (!modelId) continue;
                const loadedSuffix = item?.loaded ? ' ‚Ä¢ loaded' : '';
                const sizeSuffix = item?.size_human ? ` ‚Ä¢ ${item.size_human}` : '';
                result.push({
                    value: modelId,
                    label: `LOCAL ‚Ä¢ ${modelId}${loadedSuffix}${sizeSuffix}`,
                });
            }

            for (const item of cloudPresets) {
                const modelId = String(item?.id || '').trim();
                if (!modelId) continue;
                result.push({
                    value: modelId,
                    label: `CLOUD ‚Ä¢ ${modelId}`,
                });
            }

            for (const modelId of Object.values(cloudSlots)) {
                const text = String(modelId || '').trim();
                if (!text) continue;
                result.push({
                    value: text,
                    label: `CURRENT ‚Ä¢ ${text}`,
                });
            }

            const dedup = [];
            const seen = new Set();
            for (const item of result) {
                if (seen.has(item.value)) continue;
                seen.add(item.value);
                dedup.push(item);
            }
            return dedup;
        }

        function syncSlotModelSelection() {
            const slotNode = document.getElementById('modelSlotSelect');
            const modelNode = document.getElementById('modelChoiceSelect');
            if (!slotNode || !modelNode || !modelCatalogState) return;
            const slot = String(slotNode.value || '').trim();
            const currentModel = String((modelCatalogState.cloud_slots || {})[slot] || '').trim();
            if (!currentModel) return;
            const found = Array.from(modelNode.options).some((option) => option.value === currentModel);
            if (found) {
                modelNode.value = currentModel;
            }
        }

        function syncModelControls(catalog) {
            modelCatalogState = catalog || {};
            const mode = normalizedForceMode(catalog?.force_mode);
            const slotNames = Array.isArray(catalog?.slots) ? catalog.slots : [];
            const quickPresets = Array.isArray(catalog?.quick_presets) ? catalog.quick_presets : [];
            const selectedSlot = String(document.getElementById('modelSlotSelect')?.value || '');

            fillSelect(
                'modelModeSelect',
                [
                    { value: 'auto', label: 'auto (local-first)' },
                    { value: 'local', label: 'local (force_local)' },
                    { value: 'cloud', label: 'cloud (force_cloud)' },
                ],
                mode
            );
            fillSelect(
                'modelPresetSelect',
                quickPresets.length
                    ? quickPresets.map((item) => ({
                        value: item.id,
                        label: `${item.title} ‚Äî ${item.description}`,
                    }))
                    : [{ value: 'balanced_auto', label: 'Balanced Auto' }],
                String(document.getElementById('modelPresetSelect')?.value || 'balanced_auto')
            );
            fillSelect(
                'modelSlotSelect',
                slotNames.length
                    ? slotNames.map((slot) => ({ value: slot, label: slot }))
                    : [{ value: 'chat', label: 'chat' }],
                selectedSlot && slotNames.includes(selectedSlot) ? selectedSlot : (slotNames[0] || 'chat')
            );

            const modelOptions = getModelOptionsFromCatalog(catalog);
            fillSelect(
                'modelChoiceSelect',
                modelOptions.length ? modelOptions : [{ value: '', label: '(–º–æ–¥–µ–ª–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã)' }],
                ''
            );
            syncSlotModelSelection();

            const localState = catalog?.local_available ? 'local=online' : 'local=offline';
            const active = catalog?.local_active_model ? ` ‚Ä¢ active=${catalog.local_active_model}` : '';
            setText('modelControlMeta', `–ö–∞—Ç–∞–ª–æ–≥ –æ–±–Ω–æ–≤–ª–µ–Ω ‚Ä¢ mode=${mode} ‚Ä¢ ${localState}${active}`);
        }

        async function loadModelCatalog(showStatus = true) {
            try {
                const payload = await fetchJson('/api/model/catalog');
                if (!payload?.ok) {
                    throw new Error(payload?.error || 'model_catalog_failed');
                }
                syncModelControls(payload.catalog || {});
                if (showStatus) {
                    setText('modelControlMeta', '–ö–∞—Ç–∞–ª–æ–≥ –º–æ–¥–µ–ª–µ–π –≥–æ—Ç–æ–≤.');
                }
            } catch (error) {
                setText('modelControlMeta', `–û—à–∏–±–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –º–æ–¥–µ–ª–µ–π: ${error.message}`);
            }
        }

        async function applyModelAction(action, extraPayload = {}) {
            try {
                setText('modelControlMeta', '–ü—Ä–∏–º–µ–Ω—è—é –∏–∑–º–µ–Ω–µ–Ω–∏—è...');
                const payload = await postJson('/api/model/apply', { action, ...extraPayload }, true, 'POST');
                if (!payload?.ok) {
                    throw new Error(payload?.error || 'model_apply_failed');
                }
                syncModelControls(payload.catalog || {});
                if (payload.message) {
                    document.getElementById('assistantOutput').textContent = String(payload.message);
                }
                setText('modelControlMeta', payload.message || '–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.');
                await updateStats();
            } catch (error) {
                setText('modelControlMeta', `–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è: ${error.message}`);
            }
        }

        function appendPromptChunk(chunk) {
            const node = document.getElementById('assistantPrompt');
            const existing = String(node.value || '').trim();
            const incoming = String(chunk || '').trim();
            if (!incoming) return;
            node.value = existing ? `${existing}\n\n${incoming}` : incoming;
        }

        async function attachSelectedFileToPrompt() {
            const input = document.getElementById('assistantFileInput');
            const files = input?.files || [];
            if (!files.length) {
                setText('quickActionMeta', '–í—ã–±–µ—Ä–∏ —Ñ–∞–π–ª –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ prompt.');
                return;
            }
            const file = files[0];
            try {
                setText('quickActionMeta', `–ó–∞–≥—Ä—É–∂–∞—é —Ñ–∞–π–ª: ${file.name}...`);
                const formData = new FormData();
                formData.append('file', file);

                const headers = {};
                const webApiKey = readWebApiKey();
                if (webApiKey) {
                    headers['X-Krab-Web-Key'] = webApiKey;
                }

                const response = await fetch('/api/assistant/attachment', {
                    method: 'POST',
                    headers,
                    body: formData,
                });
                const payload = await response.json();
                if (!response.ok) {
                    throw new Error(payload?.detail || `HTTP ${response.status}`);
                }
                const attachment = payload?.attachment || {};
                appendPromptChunk(String(attachment.prompt_snippet || ''));
                setText(
                    'quickActionMeta',
                    `–§–∞–π–ª –¥–æ–±–∞–≤–ª–µ–Ω: ${attachment.file_name || file.name} ‚Ä¢ ${attachment.kind || 'attachment'}`
                );
            } catch (error) {
                setText('quickActionMeta', `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: ${error.message}`);
            }
        }

        async function runQuickWebSearch() {
            const query = (document.getElementById('quickWebQuery').value || '').trim();
            if (!query) {
                setText('quickActionMeta', '–í–≤–µ–¥–∏ –∑–∞–ø—Ä–æ—Å –¥–ª—è web-search.');
                return;
            }
            document.getElementById('assistantTaskType').value = 'chat';
            document.getElementById('assistantReasoningDepth').value = 'balanced';
            appendPromptChunk(
`–°–¥–µ–ª–∞–π web-search –ø–æ —Ç–µ–º–µ: "${query}".
–ù—É–∂–µ–Ω –∫—Ä–∞—Ç–∫–∏–π –æ—Ç—á–µ—Ç: –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç—ã, 3-5 –Ω–∞–¥–µ–∂–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã.`
            );
            setText('quickActionMeta', '–®–∞–±–ª–æ–Ω web-search –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω. –ó–∞–ø—É—Å–∫–∞—é...');
            await assistantQuery();
        }

        async function runQuickDeepResearch() {
            const topic = (document.getElementById('quickDeepTopic').value || '').trim();
            if (!topic) {
                setText('quickActionMeta', '–í–≤–µ–¥–∏ —Ç–µ–º—É –¥–ª—è deep research.');
                return;
            }
            document.getElementById('assistantTaskType').value = 'reasoning';
            document.getElementById('assistantReasoningDepth').value = 'deep';
            appendPromptChunk(
`Deep research –ø–æ —Ç–µ–º–µ: "${topic}".
–°–æ–±–µ—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç:
1) –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ,
2) –∫–ª—é—á–µ–≤—ã–µ —Ä–∏—Å–∫–∏/–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏,
3) —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤,
4) –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π,
5) —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏.`
            );
            setText('quickActionMeta', '–®–∞–±–ª–æ–Ω deep research –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω. –ó–∞–ø—É—Å–∫–∞—é...');
            await assistantQuery();
        }

        async function runQuickUrlReview() {
            const sourceUrl = (document.getElementById('quickSourceUrl').value || '').trim();
            if (!sourceUrl) {
                setText('quickActionMeta', '–í–≤–µ–¥–∏ URL –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞.');
                return;
            }
            document.getElementById('assistantTaskType').value = 'reasoning';
            document.getElementById('assistantReasoningDepth').value = 'balanced';
            appendPromptChunk(
`–†–∞–∑–±–µ—Ä–∏ –º–∞—Ç–µ—Ä–∏–∞–ª –ø–æ —Å—Å—ã–ª–∫–µ: ${sourceUrl}
–ù—É–∂–Ω–æ:
- –∫—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ;
- –∫–ª—é—á–µ–≤—ã–µ —Ç–µ–∑–∏—Å—ã/—Ñ–∞–∫—Ç—ã;
- —á—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç practically –¥–ª—è –º–µ–Ω—è;
- –µ—Å–ª–∏ —ç—Ç–æ YouTube: –≤—ã–¥–µ–ª–∏ –≥–ª–∞–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã –∏ —Ç–∞–π–º-–∫–æ–¥—ã (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã).`
            );
            setText('quickActionMeta', '–®–∞–±–ª–æ–Ω URL-–∞–Ω–∞–ª–∏–∑–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω. –ó–∞–ø—É—Å–∫–∞—é...');
            await assistantQuery();
        }

        async function opsAckAction(isAck) {
            const code = (document.getElementById('opsAlertCode').value || '').trim();
            const note = (document.getElementById('opsAlertNote').value || '').trim();
            if (!code) {
                setText('opsActionMeta', '–û—à–∏–±–∫–∞: —É–∫–∞–∂–∏ alert code');
                return;
            }
            setText('opsActionMeta', `${isAck ? 'Ack' : 'Unack'} –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...`);
            try {
                if (isAck) {
                    await postJson(`/api/ops/ack/${encodeURIComponent(code)}`, { actor: 'web_panel', note });
                    setText('opsActionMeta', `OK: alert ${code} –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω`);
                } else {
                    await postJson(`/api/ops/ack/${encodeURIComponent(code)}`, {}, true, 'DELETE');
                    setText('opsActionMeta', `OK: alert ${code} —Å–Ω—è—Ç —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è`);
                }
                await updateStats();
            } catch (error) {
                setText('opsActionMeta', `–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }

        async function assistantQuery() {
            const prompt = (document.getElementById('assistantPrompt').value || '').trim();
            const taskTypeRaw = (document.getElementById('assistantTaskType').value || 'chat').trim();
            const depthRaw = (document.getElementById('assistantReasoningDepth').value || 'auto').trim().toLowerCase();
            const ragRaw = (document.getElementById('assistantUseRag').value || 'off').trim().toLowerCase();
            const webApiKey = (document.getElementById('assistantApiKey').value || '').trim();
            let taskType = taskTypeRaw || 'chat';
            const confirmExpensive = depthRaw === 'deep';

            // UX: depth=deep –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç chat -> reasoning.
            if (taskType === 'chat' && depthRaw === 'deep') {
                taskType = 'reasoning';
            }

            if (!prompt) {
                setText('assistantMeta', '–û—à–∏–±–∫–∞: –ø—É—Å—Ç–æ–π prompt');
                return;
            }

            const useRag = ['1', 'on', 'true', 'yes', 'y'].includes(ragRaw);
            const headers = { 'Content-Type': 'application/json' };
            if (webApiKey) {
                headers['X-Krab-Web-Key'] = webApiKey;
            }

            setText('assistantMeta', '–í—ã–ø–æ–ª–Ω—è—é –∑–∞–ø—Ä–æ—Å...');
            document.getElementById('assistantOutput').textContent = '‚è≥ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ...';

            try {
                const response = await fetch('/api/assistant/query', {
                    method: 'POST',
                    headers,
                    body: JSON.stringify({
                        prompt,
                        task_type: taskType || 'chat',
                        use_rag: useRag,
                        confirm_expensive: confirmExpensive
                    })
                });
                const payload = await response.json();
                if (!response.ok) {
                    throw new Error(payload?.detail || `HTTP ${response.status}`);
                }

                document.getElementById('assistantOutput').textContent = payload.reply || '(–ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç)';
                setText(
                    'assistantMeta',
                    `OK ‚Ä¢ –ø—Ä–æ—Ñ–∏–ª—å: ${payload.profile || '-'} ‚Ä¢ task: ${payload.task_type || '-'} ‚Ä¢ depth: ${depthRaw}`
                );
                const lastRoute = payload.last_route || {};
                if (lastRoute.profile) {
                    document.getElementById('feedbackProfile').value = String(lastRoute.profile);
                }
                if (lastRoute.model || lastRoute.channel) {
                    setText(
                        'feedbackMeta',
                        `–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–æ–≥–æ–Ω: ${lastRoute.model || '-'} (${lastRoute.channel || '-'})`
                    );
                }
            } catch (error) {
                document.getElementById('assistantOutput').textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
                setText('assistantMeta', '–ó–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π');
            }
        }

        async function assistantPreflight() {
            const prompt = (document.getElementById('assistantPrompt').value || '').trim();
            const taskTypeRaw = (document.getElementById('assistantTaskType').value || 'chat').trim();
            const depthRaw = (document.getElementById('assistantReasoningDepth').value || 'auto').trim().toLowerCase();
            const webApiKey = (document.getElementById('assistantApiKey').value || '').trim();
            const selectedModel = (document.getElementById('modelChoiceSelect').value || '').trim();
            let taskType = taskTypeRaw || 'chat';
            const confirmExpensive = depthRaw === 'deep';

            if (taskType === 'chat' && depthRaw === 'deep') {
                taskType = 'reasoning';
            }

            if (!prompt) {
                setText('assistantMeta', '–û—à–∏–±–∫–∞: –ø—É—Å—Ç–æ–π prompt');
                return;
            }

            const headers = { 'Content-Type': 'application/json' };
            if (webApiKey) {
                headers['X-Krab-Web-Key'] = webApiKey;
            }

            setText('assistantMeta', '–°–æ–±–∏—Ä–∞—é preflight-–ø–ª–∞–Ω...');
            document.getElementById('assistantOutput').textContent = '‚è≥ –ê–Ω–∞–ª–∏–∑ –º–∞—Ä—à—Ä—É—Ç–∞...';

            try {
                const response = await fetch('/api/model/preflight', {
                    method: 'POST',
                    headers,
                    body: JSON.stringify({
                        prompt,
                        task_type: taskType || 'chat',
                        preferred_model: selectedModel || null,
                        confirm_expensive: confirmExpensive
                    })
                });
                const payload = await response.json();
                if (!response.ok) {
                    throw new Error(payload?.detail || `HTTP ${response.status}`);
                }
                if (!payload?.ok) {
                    throw new Error(payload?.error || 'preflight_failed');
                }

                const plan = payload.preflight || {};
                const execution = plan.execution || {};
                const warnings = plan.warnings || [];
                const reasons = plan.reasons || [];
                const warningText = warnings.length ? warnings.map((item) => `- ${item}`).join('\n') : '- –Ω–µ—Ç';
                const reasonText = reasons.length ? reasons.map((item) => `- ${item}`).join('\n') : '- –Ω–µ—Ç';

                document.getElementById('assistantOutput').textContent =
`Preflight:
task_type=${plan.task_type || '-'}
profile=${plan.profile || '-'}
critical=${plan.critical ? 'yes' : 'no'}
channel=${execution.channel || '-'}
model=${execution.model || '-'}
can_run_now=${execution.can_run_now ? 'yes' : 'no'}
requires_confirm=${execution.requires_confirm_expensive ? 'yes' : 'no'}
marginal_cost_usd=${plan.cost_hint?.marginal_call_cost_usd ?? 0}

reasons:
${reasonText}

warnings:
${warningText}

next_step: ${plan.next_step || '–ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∑–∞–¥–∞—á—É.'}`;
                setText(
                    'assistantMeta',
                    `Preflight OK ‚Ä¢ –ø—Ä–æ—Ñ–∏–ª—å: ${plan.profile || '-'} ‚Ä¢ –∫–∞–Ω–∞–ª: ${execution.channel || '-'} ‚Ä¢ depth: ${depthRaw}`
                );
            } catch (error) {
                document.getElementById('assistantOutput').textContent = `–û—à–∏–±–∫–∞ preflight: ${error.message}`;
                setText('assistantMeta', 'Preflight –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π');
            }
        }

        async function submitModelFeedback() {
            const scoreRaw = (document.getElementById('feedbackScore').value || '').trim();
            const profileRaw = (document.getElementById('feedbackProfile').value || '').trim();
            const noteRaw = (document.getElementById('feedbackNote').value || '').trim();
            const score = Number.parseInt(scoreRaw, 10);

            if (!Number.isInteger(score) || score < 1 || score > 5) {
                setText('feedbackMeta', '–û—à–∏–±–∫–∞: score –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 5');
                return;
            }

            setText('feedbackMeta', '–°–æ—Ö—Ä–∞–Ω—è—é feedback...');
            try {
                const payload = { score, note: noteRaw };
                if (profileRaw) {
                    payload.profile = profileRaw.toLowerCase();
                }
                const response = await postJson('/api/model/feedback', payload, true, 'POST');
                if (!response?.ok) {
                    throw new Error(response?.error || 'feedback_submit_failed');
                }

                const result = response.result || {};
                setText(
                    'feedbackMeta',
                    `OK: ${result.model || '-'} (${result.profile || '-'}) ‚Üí ${result.profile_model_stats?.avg ?? 0}/5`
                );
            } catch (error) {
                setText('feedbackMeta', `–û—à–∏–±–∫–∞ feedback: ${error.message}`);
            }
        }

        async function loadModelFeedbackStats() {
            const profileRaw = (document.getElementById('feedbackProfile').value || '').trim();
            const query = profileRaw ? `?profile=${encodeURIComponent(profileRaw.toLowerCase())}&top=5` : '?top=5';
            setText('feedbackMeta', '–ó–∞–≥—Ä—É–∂–∞—é feedback-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É...');

            try {
                const payload = await fetchJson(`/api/model/feedback${query}`);
                if (!payload?.ok) {
                    throw new Error(payload?.error || 'feedback_summary_failed');
                }
                const feedback = payload.feedback || {};
                const models = feedback.top_models || [];
                const channels = feedback.top_channels || [];
                const modelsText = models.length
                    ? models.map((item) => `- ${item.model} (${item.profile}): ${item.avg_score}/5, n=${item.count}`).join('\n')
                    : '- –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                const channelsText = channels.length
                    ? channels.map((item) => `- ${item.channel}: ${item.avg_score}/5, n=${item.count}`).join('\n')
                    : '- –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                document.getElementById('assistantOutput').textContent =
`Feedback summary:
profile=${feedback.profile || 'all'}
total_feedback=${feedback.total_feedback || 0}

top models:
${modelsText}

top channels:
${channelsText}`;
                setText('feedbackMeta', `Feedback loaded ‚Ä¢ total=${feedback.total_feedback || 0}`);
            } catch (error) {
                setText('feedbackMeta', `–û—à–∏–±–∫–∞ feedback stats: ${error.message}`);
            }
        }

        async function updateStats() {
            try {
                const [stats, health, links, recommend, feedbackPayload, usagePayload, alertsPayload, historyPayload] = await Promise.all([
                    fetchJson('/api/stats'),
                    fetchJson('/api/health'),
                    fetchJson('/api/links'),
                    fetchJson('/api/model/recommend?profile=chat'),
                    fetchJson('/api/model/feedback?profile=chat&top=1'),
                    fetchJson('/api/ops/usage'),
                    fetchJson('/api/ops/alerts'),
                    fetchJson('/api/ops/history?limit=8')
                ]);

                const bb = stats.black_box || {};
                const rag = stats.rag || {};
                const router = stats.router || {};

                setText('bb_total', String(bb.total ?? bb.total_messages ?? 0));
                setText('rag_total', String(rag.count ?? 0));
                setText('local_model', router.local_model || 'Offline');
                setText('degradation', health.degradation || 'unknown');

                const checks = health.checks || {};
                document.getElementById('checks').innerHTML =
                    badge(!!checks.openclaw, 'OpenClaw') +
                    badge(!!checks.local_lm, 'Local LM') +
                    badge(!!checks.voice_gateway, 'Voice Gateway') +
                    badge(!!checks.krab_ear, 'Krab Ear');

                const linksBlock = [
                    ['Dashboard', links.dashboard],
                    ['Stats API', links.stats_api],
                    ['Health API', links.health_api],
                    ['Ecosystem Health API', links.ecosystem_health_api],
                    ['Model Preflight API', `${links.dashboard}/api/model/preflight`],
                    ['Model Feedback API', `${links.dashboard}/api/model/feedback`],
                    ['OpenClaw Deep Check', `${links.dashboard}/api/openclaw/deep-check`],
                    ['OpenClaw Remediation Plan', `${links.dashboard}/api/openclaw/remediation-plan`],
                    ['OpenClaw Browser Smoke', `${links.dashboard}/api/openclaw/browser-smoke`],
                    ['Assistant Capabilities', `${links.dashboard}/api/assistant/capabilities`],
                    ['Ops Cost Report', `${links.dashboard}/api/ops/cost-report`],
                    ['Ops Executive Summary', `${links.dashboard}/api/ops/executive-summary`],
                    ['Ops Full Report', `${links.dashboard}/api/ops/report`],
                    ['Ops Bundle Export', `${links.dashboard}/api/ops/bundle/export`],
                    ['OpenClaw', links.openclaw],
                    ['Voice Gateway', links.voice_gateway],
                ].filter(([, url]) => !!url)
                 .map(([name, url]) => `<a href="${url}" target="_blank" rel="noreferrer">${name}: ${url}</a>`)
                 .join('');
                document.getElementById('links').innerHTML = linksBlock || '‚Äî';

                setText('recommended_model', recommend.model || '‚Äî');
                const bestFeedback = feedbackPayload?.feedback?.top_models?.[0] || null;
                if (bestFeedback) {
                    setText(
                        'recommended_meta',
                        `–ü—Ä–æ—Ñ–∏–ª—å: ${recommend.profile || 'chat'} ‚Ä¢ –ö–∞–Ω–∞–ª: ${recommend.channel || 'auto'} ‚Ä¢ Quality: ${bestFeedback.avg_score}/5 (n=${bestFeedback.count})`
                    );
                } else {
                    setText('recommended_meta', `–ü—Ä–æ—Ñ–∏–ª—å: ${recommend.profile || 'chat'} ‚Ä¢ –ö–∞–Ω–∞–ª: ${recommend.channel || 'auto'}`);
                }

                const usage = usagePayload.usage || {};
                const totals = usage.totals || {};
                const ratios = usage.ratios || {};
                const softCap = usage.soft_cap || {};
                setText(
                    'opsUsageMeta',
                    `Calls: total=${totals.all_calls ?? 0}, cloud=${totals.cloud_calls ?? 0}, local=${totals.local_calls ?? 0} ‚Ä¢ cloud_share=${ratios.cloud_share ?? 0} ‚Ä¢ cap_left=${softCap.cloud_remaining_calls ?? 0}`
                );

                const alertsRoot = alertsPayload.alerts || {};
                const alertsList = alertsRoot.alerts || [];
                if (!alertsList.length) {
                    document.getElementById('opsAlerts').innerHTML = '<span class="badge ok">OK no active alerts</span>';
                } else {
                    const html = alertsList
                        .map((item) => {
                            const ack = item.acknowledged ? ` <span class="badge ok">ACK ${item.ack?.actor || ''}</span>` : '';
                            return `<div><span class="badge ${item.severity === 'high' ? 'bad' : 'warn'}">${item.severity || 'info'}</span> ${item.code || ''} ‚Äî ${item.message || ''}${ack}</div>`;
                        })
                        .join('');
                    document.getElementById('opsAlerts').innerHTML = html;
                }

                const history = historyPayload.history?.items || [];
                if (!history.length) {
                    setText('opsHistory', '–ò—Å—Ç–æ—Ä–∏—è ops: –ø—É—Å—Ç–æ');
                } else {
                    document.getElementById('opsHistory').innerHTML = history
                        .map((item) => `${item.ts || '-'} ‚Ä¢ ${item.status || '-'} ‚Ä¢ alerts=${item.alerts_count ?? 0} ‚Ä¢ codes=${(item.codes || []).join(',') || '-'}`)
                        .join('<br>');
                }
                setText('updated_at', `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleTimeString()}`);
            } catch (error) {
                console.error('Stats update failed', error);
                setText('updated_at', `–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${error.message}`);
            }
        }

        async function refreshAll() {
            await updateStats();
            await loadModelCatalog(false);
        }

        document.getElementById('refreshBtn').addEventListener('click', refreshAll);
        document.getElementById('assistantRunBtn').addEventListener('click', assistantQuery);
        document.getElementById('assistantPlanBtn').addEventListener('click', assistantPreflight);
        document.getElementById('feedbackSendBtn').addEventListener('click', submitModelFeedback);
        document.getElementById('feedbackStatsBtn').addEventListener('click', loadModelFeedbackStats);
        document.getElementById('opsAckBtn').addEventListener('click', () => opsAckAction(true));
        document.getElementById('opsUnackBtn').addEventListener('click', () => opsAckAction(false));
        document.getElementById('modelCatalogReloadBtn').addEventListener('click', () => loadModelCatalog(true));
        document.getElementById('modelApplyModeBtn').addEventListener('click', async () => {
            const mode = (document.getElementById('modelModeSelect').value || 'auto').trim();
            await applyModelAction('set_mode', { mode });
        });
        document.getElementById('modelApplyPresetBtn').addEventListener('click', async () => {
            const preset = (document.getElementById('modelPresetSelect').value || '').trim();
            const localModel = (document.getElementById('modelChoiceSelect').value || '').trim();
            await applyModelAction('apply_preset', { preset, local_model: localModel });
        });
        document.getElementById('modelApplySlotBtn').addEventListener('click', async () => {
            const slot = (document.getElementById('modelSlotSelect').value || '').trim();
            const model = (document.getElementById('modelChoiceSelect').value || '').trim();
            await applyModelAction('set_slot_model', { slot, model });
        });
        document.getElementById('modelSlotSelect').addEventListener('change', syncSlotModelSelection);
        document.getElementById('assistantAttachBtn').addEventListener('click', attachSelectedFileToPrompt);
        document.getElementById('quickWebBtn').addEventListener('click', runQuickWebSearch);
        document.getElementById('quickDeepBtn').addEventListener('click', runQuickDeepResearch);
        document.getElementById('quickUrlBtn').addEventListener('click', runQuickUrlReview);
        setInterval(updateStats, 8000);
        refreshAll();
    </script>
</body>

</html>

#!/bin/zsh
# ==============================================================
# ü¶Ä Krab v2.0 ‚Äî –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞
# ==============================================================

cd "$(dirname "$0")"

echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é Krab v2.0..."

if [ -f krab.pid ]; then
    PID=$(cat krab.pid)
    if ps -p $PID > /dev/null 2>&1; then
        kill $PID
        echo "‚úÖ –ü—Ä–æ—Ü–µ—Å—Å $PID –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω."
    else
        echo "‚ö†Ô∏è  –ü—Ä–æ—Ü–µ—Å—Å $PID —É–∂–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç."
    fi
    rm -f krab.pid
else
    # –ü–æ–ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ –∏–º–µ–Ω–∏
    PIDS=$(pgrep -f "python3 -m src.main")
    if [ -n "$PIDS" ]; then
        echo "$PIDS" | xargs kill
        echo "‚úÖ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: $PIDS"
    else
        echo "‚ÑπÔ∏è  –ë–æ—Ç —É–∂–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω."
    fi
fi

echo ""
echo "–ù–∞–∂–º–∏ Enter –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è..."
read

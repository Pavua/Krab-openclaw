# План Интеграции Frontend V2 (R2)

Данный документ описывает процесс перевода Krab Web Panel на новый дизайн "Nano Banana Pro" (V2) и интеграции нового интерфейса с существующим production бэкендом.

## Цели Интеграции


1. **Бесшовная замена интерфейса:** Замена текущего монолитного `index.html` на новый `index_redesign.html` без потери функциональности.
2. **Обратная совместимость:** Полное сохранение работоспособности JS-логики и взаимодействия с API бэкенда (`/api/stats`, `/api/model/*`, `/api/ops/*`, `/api/assistant/*`).
3. **Сохранение стилистики:** Применение нового CSS-грида и дизайн-токенов "Nano Banana Pro" ко всем компонентам без использования сторонних UI-фреймворков.


## Этапы Интеграции


### Этап 1: Подготовка прототипа и перенос JS (Frontend R2) - ЗАВЕРШЕНО


- Разметка `index_redesign.html` была обновлена: добавлены все необходимые ID для JS-скриптов (`badge`, `bb_total`, `degradation`, `assistantOutput`, `opsHistory` и проч.).
- Успешно пройдена валидация на совместимость ID скриптом `validate_web_prototype_compat.command`.
- Оригинальный JS-код без изменений перенесен из `index.html` в `index_redesign.html` (вместо JS-заглушек).



### Этап 2: Замена и Smoke-тестирование


- Замена оригинального `src/web/index.html` новым `index_redesign.html` (переименование/перемещение).
- Запуск Krab Backend и проведение Smoke-тестирования:
  - Проверка успешной загрузки страницы V2.
  - Убедиться, что статистика подгружается (Health checks, Black Box, Models).
  - Выполнить `/api/model/preflight` запрос через интерфейс ассистента.
  - Сделать текстовый запрос в чат ассистенту.
  - Проверить применение настроек роутинга и пресетов.
- Мониторинг консоли браузера на наличие ошибок (CORS, Missing Elements, API Errors).
- Если найдена проблема, сделать rollback на старый `index.html`. Если все стабильно - зафиксировать версию V2.



### Этап 3: Подключение новых интерфейсов (Transcriber, Ops Center)


После фиксации основной панели будет начат поэтапный перевод новых модулей:

1. **Transcriber Console:** Интеграция API диктофона/транскрипции (Audio API WebSocket / SSE stream). Связывание счетчиков и логов ошибок с Ops Center.
2. **Ops Center:** Настройка агрегации телеметрии, настройка WebSocket-соединения для получения потока журналов и алертов в реальном времени.


## Риски и Fallback

- **Сломан JS Binding:** В случае переименования любого из критических ID в HTML, JS может выдать `Cannot read properties of null` и сломать цикл `updateStats`. **Mitigation:** Выполнен строгий скрипт проверки совместимости, все ID 1 в 1 совпадают.
- **Ошибки верстки при динамических данных:** Модальные окна, объемные логи или длинные имена моделей могут "выбить" верстку grid-карточек. **Mitigation:** На карточках установлены `overflow-y: auto`, `word-break: break-word` для безопасного рендеринга больших объемов текста.

## Критерии приемки (Definition of Done)

- `index_redesign.html` переведен в продакшн как основной UI.
- Отсутствуют JS-ошибки в консоли веб-браузера при работе.
- Основные CRUD и рабочие операции (Chat, Configure Routing, View Stats) подтверждены.
- Дизайн соответствует `DESIGN_SPEC_RU.md`.

# –û—Ç—á–µ—Ç –ø–æ –°–ø—Ä–∏–Ω—Ç—É R16: Cloud Cost Routing + Anti-Stuck Reply Pipeline

## üéØ –û–±–∑–æ—Ä

–°–ø—Ä–∏–Ω—Ç –±—ã–ª —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω –Ω–∞ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –±—ç–∫–µ–Ω–¥–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –æ–±–ª–∞—á–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–∏ "–∑–∞–≤–∏—Å–∞–Ω–∏–π" –ø—Ä–æ—Ü–µ—Å—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### 1. Cloud Tiered Fallback (Free -> Paid)

- **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ API –∫–ª—é—á–∏**: `ModelRouter` —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç JSON-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `OPENCLAW_API_KEY`, –ø–æ–∑–≤–æ–ª—è—è –∑–∞–¥–∞–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `free` –∏ `paid`).
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥**: –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π –∫–≤–æ—Ç—ã (429) –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç–æ–º, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –ø–ª–∞—Ç–Ω—ã–π —Ç–∏—Ä –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏.
- **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–±—Ä–æ—Å**: –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø–ª–∞—Ç–Ω–æ–º —Ç–∏—Ä–µ, –∫–ª–∏–µ–Ω—Ç —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ `free` –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –±—é–¥–∂–µ—Ç–∞.

### 2. Anti-Stuck Reply Pipeline (SLA Guard)

- **SLA Timeout**: –í–Ω–µ–¥—Ä–µ–Ω –∂–µ—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥–∏ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ 35 —Å–µ–∫—É–Ω–¥).
- **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ**: –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–î—É–º–∞—é...") –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç, –æ–Ω–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≤–µ—á–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ "thinking..." –≤ Telegram.
- **–ú–µ—Ç—Ä–∏–∫–∏ SLA**: –î–æ–±–∞–≤–ª–µ–Ω —Å—á–µ—Ç—á–∏–∫ `sla_aborts` –≤ –æ—Ç—á–µ—Ç—ã –æ –∑–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤ –≤ `task_queue.py` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ñ–æ–Ω–æ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

## üß™ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã

- `tests/test_r16_queue_sla_abort.py`: –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å—à–µ–π –∑–∞–¥–∞—á–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è. **[PASS]**
- `tests/test_r16_cloud_tier_fallback.py`: –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å Free –Ω–∞ Paid –ø—Ä–∏ –æ—à–∏–±–∫–µ 429. **[PASS]**

## üìÇ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- [src/core/task_queue.py](file:///Users/pablito/Antigravity_AGENTS/–ö—Ä–∞–±/src/core/task_queue.py) ‚Äî –≤–Ω–µ–¥—Ä–µ–Ω SLA –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞.
- [src/core/openclaw_client.py](file:///Users/pablito/Antigravity_AGENTS/–ö—Ä–∞–±/src/core/openclaw_client.py) ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏—Ä–æ–≤ –∫–ª—é—á–µ–π.
- [src/core/model_manager.py](file:///Users/pablito/Antigravity_AGENTS/–ö—Ä–∞–±/src/core/model_manager.py) ‚Äî –ª–æ–≥–∏–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Å Tiered Fallback.

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å (macOS)

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `verify_r16.command`. –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ –¥–ª—è –ø—Ä–æ–≥–æ–Ω–∞ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ R16.

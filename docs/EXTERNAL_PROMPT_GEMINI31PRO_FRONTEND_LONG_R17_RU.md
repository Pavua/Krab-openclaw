# Frontend R17 (Gemini 3.1 Pro + Nano Banana Pro) — Control UI, Диагностика, UX

Работаешь в репозитории Krab (`/Users/pablito/Antigravity_AGENTS/Краб`) с открытой папкой проекта.

## Цели спринта

1. Сделать Web Panel действительно управляющей: понятное переключение `auto/local/cloud`, видимый active route и health.
2. Добавить визуальную диагностику cloud-ключей (google/openai) на основе уже существующих backend API.
3. Устранить UX-состояния “кажется зависло” (например, вечное “думaю” без прогресса).
4. Удержать совместимость с текущими API и мобильными экранами.

## Ограничения

- Не ломай существующие id/selectors без необходимости.
- Сохраняй текущую архитектуру: UI — тонкий слой над backend API.
- Никаких моков “для красоты” вместо реальных данных.

## Задачи (объёмный пакет)

### 1) Control Center v2 polish

- В блоке управления роутингом:
  - чётко показать текущий режим (`auto`, `force_local`, `force_cloud`);
  - текущий активный канал (`local/cloud`);
  - active model;
  - последняя причина маршрутизации (route reason/detail).
- Для кнопок `Set Local/Set Auto/Set Cloud` сделать единый UX:
  - `loading`, `success`, `error`;
  - блокировка повторного клика, пока запрос в полёте.

### 2) Cloud Keys Diagnostics Panel

- Добавить секцию “Cloud ключи”:
  - `google`: ok/fail + код + summary;
  - `openai`: ok/fail + код + summary;
  - источник ключа (`env:*`, `auth_profiles:*`) без вывода ключа.
- Для частых ошибок (`api_key_invalid`, `api_key_leaked`, `api_disabled`, `quota_or_billing`) показать понятную подсказку next-step.

### 3) Queue/Reply Observability UI

- Добавить мини-панель “Очередь и ответы”:
  - длина очереди;
  - oldest task age;
  - число задач в retry/abort;
  - счётчик guard-trigger (если backend отдаёт).
- Автообновление без мерцания, с graceful-degrade при недоступном API.

### 4) OpenClaw Dashboard integration hints

- Если OpenClaw dashboard возвращает `unauthorized token missing`, показывать заметку “куда вставить token” в понятном виде.
- Добавить action-кнопку “Проверить подключение OpenClaw” (без навязчивых алертов).

### 5) Responsive + Visual consistency

- Добить мобильные брейкпоинты и читаемость таблиц/логов.
- Нормализовать состояния кнопок, полей и ошибок (единый дизайн-токен).
- Сохранить совместимость с существующими smoke-скриптами проверки id.

## Проверка

- Прогони существующие в проекте проверки совместимости фронта (если есть).
- Добавь/обнови smoke-скрипт(ы) для новых блоков UI.
- Подтверди, что старые API-path не сломаны.

## Формат сдачи

- Список изменённых файлов.
- Что именно появилось в UI.
- Какие проверки/скрипты запущены и их результат.

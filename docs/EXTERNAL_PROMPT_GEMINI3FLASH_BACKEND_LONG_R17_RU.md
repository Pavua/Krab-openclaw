# Backend R17 (Gemini Flash) ‚Äî –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤ + Cloud –∫–ª—é—á–∏ + Multi-agent MVP

–†–∞–±–æ—Ç–∞–µ—à—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ Krab (`/Users/pablito/Antigravity_AGENTS/–ö—Ä–∞–±`) —Å –æ—Ç–∫—Ä—ã—Ç–æ–π –ø–∞–ø–∫–æ–π –ø—Ä–æ–µ–∫—Ç–∞.

## –¶–µ–ª–∏ —Å–ø—Ä–∏–Ω—Ç–∞

1. –£–±—Ä–∞—Ç—å –∫–µ–π—Å—ã, –∫–æ–≥–¥–∞ –±–æ—Ç –≤ Telegram —Å—Ç–∞–≤–∏—Ç —Ä–µ–∞–∫—Ü–∏—é/`ü§î –î—É–º–∞—é...`, –Ω–æ –Ω–µ –≤—ã–¥–∞—ë—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.
2. –£—Å–∏–ª–∏—Ç—å cloud-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É (google/openai) –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –±–µ–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –º—É—Å–æ—Ä–∞.
3. –î–æ–¥–µ–ª–∞—Ç—å –∏ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å free‚Üípaid fallback –¥–ª—è Gemini –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–æ—É—Ç–µ—Ä–∞.
4. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å MVP –¥–ª—è ‚Äú–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤ –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ‚Äù (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã, –±–µ–∑ –ª–æ–º–∫–∏ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã).

## –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ù–µ –ª–æ–º–∞–π —Ç–µ–∫—É—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã.
- –ù–µ —Ç—Ä–æ–≥–∞–π —Å–µ–∫—Ä–µ—Ç—ã, –Ω–µ –ø–∏—à–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –≤ –∫–æ–¥/–ª–æ–≥–∏.
- –ù–µ –¥—É–±–ª–∏—Ä—É–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª OpenClaw; –∏—Å–ø–æ–ª—å–∑—É–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `OpenClawClient`.

## –ó–∞–¥–∞—á–∏ (–æ–±—ä—ë–º–Ω—ã–π –ø–∞–∫–µ—Ç)

### 1) Reply Completion Guard

- –ù–∞–π–¥–∏ –≤–µ—Ç–∫–∏ –≤ `src/handlers/ai.py` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ—á–µ—Ä–µ–¥—è—Ö, –≥–¥–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ ‚Äú–¥—É–º–∞—é/–≤ –æ—á–µ—Ä–µ–¥–∏‚Äù –±–µ–∑ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.
- –î–æ–±–∞–≤—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π guard:
  - –ª–∏–±–æ –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞;
  - –ª–∏–±–æ –∫–æ—Ä–æ—Ç–∫–æ–µ fallback-—Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äú–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–±–æ–π, –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ —á–µ—Ä–µ–∑ N —Å–µ–∫—É–Ω–¥‚Äù;
  - –ª–∏–±–æ —è–≤–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å –∫–æ–¥–æ–º –ø—Ä–∏—á–∏–Ω—ã –≤ –ª–æ–≥.
- –î–æ–±–∞–≤—å –º–µ—Ç—Ä–∏–∫—É/—Å—á—ë—Ç—á–∏–∫ ‚Äúreply_incomplete_guard_triggered‚Äù.

### 2) –û—á–µ—Ä–µ–¥—å –∏ SLA –¥–ª—è –ª–∏—á–∫–∏/–≥—Ä—É–ø–ø

- –í `src/core/task_queue.py` —É—Å–∏–ª–∏—Ç—å SLA-–ª–æ–≥–∏–∫—É:
  - –µ—Å–ª–∏ –∑–∞–¥–∞—á–∞ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ ‚Äî –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å/–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑;
  - –Ω–µ –¥–æ–ø—É—Å–∫–∞—Ç—å –≤–µ—á–Ω—ã—Ö ‚Äú–ø–æ–∑–∏—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏‚Äù.
- –†–∞–∑–¥–µ–ª–∏—Ç—å —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é –ø–æ –∫–∞–Ω–∞–ª–∞–º (`private`, `group`, `channel`).
- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –æ—Ç—á—ë—Ç –¥–ª—è –∫–æ–º–∞–Ω–¥—ã —Å—Ç–∞—Ç—É—Å–∞.

### 3) Cloud key diagnostics UX (backend side)

- –ù–∞ –±–∞–∑–µ `OpenClawClient.get_cloud_provider_diagnostics` —Å–¥–µ–ª–∞—Ç—å —É–¥–æ–±–Ω—ã–π —Å–ª–æ–π –≤ —Ä–æ—É—Ç–µ—Ä–µ/—Ö–µ–Ω–¥–ª–µ—Ä–µ:
  - –∫–æ–¥ –æ—à–∏–±–∫–∏ (`api_key_invalid`, `api_key_leaked`, `api_disabled`, `quota_or_billing`, `network_error`);
  - —á–µ–ª–æ–≤–µ–∫–æ-–ø–æ–Ω—è—Ç–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
  - —Å–∫—Ä—ã—Ç–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ —Å—ã—Ä–æ–≥–æ JSON –≤ –æ–±—ã—á–Ω—ã—Ö —á–∞—Ç–∞—Ö.
- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É/–ø–æ–¥–∫–æ–º–∞–Ω–¥—É –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∫–ª—é—á–µ–π (–µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å ‚Äî —Ä–∞—Å—à–∏—Ä—å, –Ω–µ –¥—É–±–ª–∏—Ä—É–π).

### 4) Gemini tier fallback hardening

- –£–±–µ–¥–∏—Å—å, —á—Ç–æ fallback `free -> paid` —Ä–∞–±–æ—Ç–∞–µ—Ç:
  - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö (quota/billing/timeout);
  - –±–µ–∑ –ª–æ–∂–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤ –Ω–∞ fatal auth;
  - —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º –≤ `free` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.
- –î–æ–±–µ–π —Ç–µ—Å—Ç–∞–º–∏.

### 5) Multi-agent group MVP (–±–µ–∑ overengineering)

- –î–æ–±–∞–≤—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é ‚Äú–∫–æ–º–∞–Ω–¥–∞ –∞–≥–µ–Ω—Ç–æ–≤‚Äù:
  - –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `!swarm room <—Ç–µ–º–∞>`);
  - 2-3 —Ä–æ–ª–∏ (–∞–Ω–∞–ª–∏—Ç–∏–∫, –∫—Ä–∏—Ç–∏–∫, –∏–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä) –∫–∞–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è;
  - –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏—Ç–æ–≥ –≤ –∫–æ–Ω—Ü–µ —Ä–∞—É–Ω–¥–∞.
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ç–µ–∫—É—â–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ –±–æ—Ç–∞ (–±–µ–∑ –ø–æ–¥–Ω—è—Ç–∏—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤), –≥–ª–∞–≤–Ω–æ–µ ‚Äî —Ä–∞–±–æ—á–∞—è –ª–æ–≥–∏–∫–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏.

## –¢–µ—Å—Ç—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

- –î–æ–±–∞–≤—å/–æ–±–Ω–æ–≤–∏ —Ç–µ—Å—Ç—ã –≤ `tests/`:
  - reply completion guard;
  - queue SLA abort/retry;
  - cloud diagnostics classification;
  - gemini tier fallback;
  - multi-agent room basic flow.
- –ó–∞–ø—É—Å—Ç–∏ –º–∏–Ω–∏–º—É–º:
  - `pytest -q tests/test_r16_cloud_tier_fallback.py`
  - `pytest -q tests/test_r16_queue_sla_abort.py`
  - `pytest -q tests/test_r15_preflight_gate.py`
  - `pytest -q` (–µ—Å–ª–∏ —É—Å–ø–µ–≤–∞–µ—à—å)

## –§–æ—Ä–º–∞—Ç —Å–¥–∞—á–∏

- –ö—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ —Ñ–∞–π–ª–∞–º.
- –ö–∞–∫–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ (—Ç–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã + —Ä–µ–∑—É–ª—å—Ç–∞—Ç).
- –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Ä–∏—Å–∫–æ–º/–¥–æ–ª–≥–æ–º (–µ—Å–ª–∏ –æ—Å—Ç–∞–ª–æ—Å—å).

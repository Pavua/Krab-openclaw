# -*- coding: utf-8 -*-
"""Swarm Manager

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1zyiNzb4ID2C2df44gyszz9JDwUgV0lS_
"""

import logging
import importlib.util
import os
from typing import Dict, Any

logger = logging.getLogger(__name__)

class SwarmManager:
    """
    –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ—è–º–∏ –∞–≥–µ–Ω—Ç–æ–≤ (CrewAI / Native).
    –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã (Trading, Dev, OSINT) –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π.
    """

    def __init__(self, swarm_dir: str = "src/swarm_definitions"):
        self.swarm_dir = swarm_dir
        self.available_swarms = {}
        self._scan_swarms()

    def _scan_swarms(self):
        """–°–∫–∞–Ω–∏—Ä—É–µ—Ç –ø–∞–ø–∫—É –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π —Ä–æ–µ–≤"""
        if not os.path.exists(self.swarm_dir):
            os.makedirs(self.swarm_dir, exist_ok=True)

        for filename in os.listdir(self.swarm_dir):
            if filename.endswith("_team.py") or filename.endswith("_swarm.py"):
                name = filename.replace(".py", "")
                self.available_swarms[name] = os.path.join(self.swarm_dir, filename)

    def list_swarms(self) -> str:
        if not self.available_swarms:
            return "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–æ–µ–≤. –î–æ–±–∞–≤—å—Ç–µ —Ñ–∞–π–ª—ã –≤ src/swarm_definitions/"
        return "\n".join([f"- {name}" for name in self.available_swarms.keys()])

    def run_swarm(self, swarm_name: str, input_data: str) -> str:
        """–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ä–æ–π"""
        if swarm_name not in self.available_swarms:
            return f"‚ùå –†–æ–π '{swarm_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω."

        file_path = self.available_swarms[swarm_name]

        try:
            # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è
            spec = importlib.util.spec_from_file_location(swarm_name, file_path)
            module = importlib.util.module_from_spec(spec)
            spec.loader.exec_module(module)

            # –ò—â–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–ø—É—Å–∫–∞ (–æ–±—ã—á–Ω–æ run_X)
            # –û–∂–∏–¥–∞–µ–º, —á—Ç–æ –≤ —Ñ–∞–π–ª–µ –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è run(input_str)
            if hasattr(module, "run"):
                logger.info(f"üöÄ –ó–∞–ø—É—Å–∫ —Ä–æ—è {swarm_name}...")
                return module.run(input_data)
            else:
                return f"‚ùå –í —Ñ–∞–π–ª–µ {swarm_name} –Ω–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ 'run(input)'."

        except Exception as e:
            logger.error(f"Swarm Error: {e}")
            return f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ä–æ—è: {e}"